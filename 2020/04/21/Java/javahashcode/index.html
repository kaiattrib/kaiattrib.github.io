<!doctype html>
<html lang="zh"><head><meta charset="utf-8"><meta name="referrer" content="no-referrer"><meta name="generator" content="Hexo 4.2.0"><meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"><meta><title>深入理解 Java HashCode - Keeplooking</title><meta description="1. hashcode1.Object的hashcode默认调用object的hashcode的话，会调用native方法，与本地相关。1public native int hashCode();"><meta property="og:type" content="blog"><meta property="og:title" content="深入理解 Java HashCode"><meta property="og:url" content="http://yoursite.com/2020/04/21/Java/javahashcode/"><meta property="og:site_name" content="Keeplooking"><meta property="og:description" content="1. hashcode1.Object的hashcode默认调用object的hashcode的话，会调用native方法，与本地相关。1public native int hashCode();"><meta property="og:locale" content="zh_CN"><meta property="og:image" content="https://cdn.nlark.com/yuque/0/2019/png/501385/1570776081370-43ef6268-0f1d-4c3a-9b7d-9894dd3cee61.png#align=left&amp;display=inline&amp;height=377&amp;name=%E6%90%9C%E7%8B%97%E6%88%AA%E5%9B%BE20191011144038.png&amp;originHeight=377&amp;originWidth=1541&amp;size=57057&amp;status=done&amp;width=1541"><meta property="og:image" content="https://cdn.nlark.com/yuque/0/2019/png/501385/1570782297262-ee25ccc2-9ee7-402b-9691-599d1aaf4b81.png#align=left&amp;display=inline&amp;height=302&amp;name=%E6%90%9C%E7%8B%97%E6%88%AA%E5%9B%BE20191011162436.png&amp;originHeight=302&amp;originWidth=886&amp;size=17459&amp;status=done&amp;width=886"><meta property="article:published_time" content="2020-04-21T14:58:14.000Z"><meta property="article:modified_time" content="2023-05-14T07:53:19.961Z"><meta property="article:author" content="Ken Chan"><meta property="article:tag" content="Java"><meta property="twitter:card" content="summary"><meta property="twitter:image" content="https://cdn.nlark.com/yuque/0/2019/png/501385/1570776081370-43ef6268-0f1d-4c3a-9b7d-9894dd3cee61.png#align=left&amp;display=inline&amp;height=377&amp;name=%E6%90%9C%E7%8B%97%E6%88%AA%E5%9B%BE20191011144038.png&amp;originHeight=377&amp;originWidth=1541&amp;size=57057&amp;status=done&amp;width=1541"><script type="application/ld+json">{"@context":"https://schema.org","@type":"BlogPosting","mainEntityOfPage":{"@type":"WebPage","@id":"http://yoursite.com/2020/04/21/Java/javahashcode/"},"headline":"Keeplooking","image":[],"datePublished":"2020-04-21T14:58:14.000Z","dateModified":"2023-05-14T07:53:19.961Z","author":{"@type":"Person","name":"Ken Chan"},"description":"1. hashcode1.Object的hashcode默认调用object的hashcode的话，会调用native方法，与本地相关。1public native int hashCode();"}</script><link rel="canonical" href="http://yoursite.com/2020/04/21/Java/javahashcode/"><link rel="icon" href="/img/favicon.png"><link rel="stylesheet" href="https://cdn.bootcss.com/font-awesome/5.13.0/css/all.css"><link rel="stylesheet" href="https://cdnjs.loli.net/ajax/libs/highlight.js/9.12.0/styles/atom-one-light.min.css"><link rel="stylesheet" href="https://cdn.staticfile.org/entypo/2.0/entypo.woff"><link rel="stylesheet" href="/css/default.css"><style>body>.footer,body>.navbar,body>.section{opacity:0}</style><!--!--><!--!--><link rel="stylesheet" href="https://cdnjs.loli.net/ajax/libs/lightgallery/1.6.8/css/lightgallery.min.css"><link rel="stylesheet" href="https://cdnjs.loli.net/ajax/libs/justifiedGallery/3.7.0/css/justifiedGallery.min.css"><!--!--><script src="https://cdnjs.loli.net/ajax/libs/pace/1.0.2/pace.min.js"></script><style>mjx-container[jax="SVG"] {
  direction: ltr;
}

mjx-container[jax="SVG"] > svg {
  overflow: visible;
}

mjx-container[jax="SVG"] > svg a {
  fill: blue;
  stroke: blue;
}

mjx-container[jax="SVG"][display="true"] {
  display: block;
  text-align: center;
  margin: 1em 0;
}

mjx-container[jax="SVG"][justify="left"] {
  text-align: left;
}

mjx-container[jax="SVG"][justify="right"] {
  text-align: right;
}

g[data-mml-node="merror"] > g {
  fill: red;
  stroke: red;
}

g[data-mml-node="merror"] > rect[data-background] {
  fill: yellow;
  stroke: none;
}

g[data-mml-node="mtable"] > line[data-line] {
  stroke-width: 70px;
  fill: none;
}

g[data-mml-node="mtable"] > rect[data-frame] {
  stroke-width: 70px;
  fill: none;
}

g[data-mml-node="mtable"] > .mjx-dashed {
  stroke-dasharray: 140;
}

g[data-mml-node="mtable"] > .mjx-dotted {
  stroke-linecap: round;
  stroke-dasharray: 0,140;
}

g[data-mml-node="mtable"] > svg {
  overflow: visible;
}

[jax="SVG"] mjx-tool {
  display: inline-block;
  position: relative;
  width: 0;
  height: 0;
}

[jax="SVG"] mjx-tool > mjx-tip {
  position: absolute;
  top: 0;
  left: 0;
}

mjx-tool > mjx-tip {
  display: inline-block;
  padding: .2em;
  border: 1px solid #888;
  font-size: 70%;
  background-color: #F8F8F8;
  color: black;
  box-shadow: 2px 2px 5px #AAAAAA;
}

g[data-mml-node="maction"][data-toggle] {
  cursor: pointer;
}

mjx-status {
  display: block;
  position: fixed;
  left: 1em;
  bottom: 1em;
  min-width: 25%;
  padding: .2em .4em;
  border: 1px solid #888;
  font-size: 90%;
  background-color: #F8F8F8;
  color: black;
}

foreignObject[data-mjx-xml] {
  font-family: initial;
  line-height: normal;
  overflow: visible;
}

.MathJax path {
  stroke-width: 3;
}

mjx-container {
  overflow: auto hidden;
}

mjx-container + br {
  display: none;
}
</style></head><body class="is-3-column"><nav class="navbar navbar-main"><div class="container"><div class="navbar-brand justify-content-center"><a class="navbar-item navbar-logo" href="/"><img src="/img/logo.png" alt="Keeplooking" height="28"></a></div><div class="navbar-menu"><div class="navbar-start"><a class="navbar-item" href="/">主页</a><a class="navbar-item" href="/archives">归档</a><a class="navbar-item" href="/categories">分类</a><a class="navbar-item" href="/tags">标签</a><a class="navbar-item" href="/suibi/suibi.html">随笔</a><a class="navbar-item" href="/comments">关于</a></div><div class="navbar-end"><a class="navbar-item is-hidden-tablet catalogue" title="目录" href="javascript:;" style="font-size: 1.5em;"><i class="fas fa-list-ul"></i></a><a class="navbar-item search" title="搜索" href="javascript:;" style="font-size: 1.5em;"><i class="fas fa-search"></i></a></div></div></div></nav><section class="section"><div class="container"><div class="columns"><div class="column order-2 column-main is-8-tablet is-8-desktop is-8-widescreen"><div class="card"><article class="card-content article" role="article"><div class="article-meta size-small is-uppercase level is-mobile"><div class="level-left"><time class="level-item" dateTime="2020-04-21T14:58:14.000Z" title="2020-04-21T14:58:14.000Z">2020-04-21</time><span class="level-item"><a class="link-muted" href="/categories/%E8%AF%AD%E8%A8%80%E5%9F%BA%E7%A1%80/">语言基础</a><span> / </span><a class="link-muted" href="/categories/%E8%AF%AD%E8%A8%80%E5%9F%BA%E7%A1%80/Java/">Java</a></span><span class="level-item">14 分钟 读完 (大约 2067 个字)</span></div></div><h1 class="title is-3 is-size-4-mobile">深入理解 Java HashCode</h1><div class="content"><h3 id="1-hashcode"><a href="#1-hashcode" class="headerlink" title="1. hashcode"></a>1. hashcode</h3><h4 id="1-Object的hashcode"><a href="#1-Object的hashcode" class="headerlink" title="1.Object的hashcode"></a>1.Object的hashcode</h4><pre><code>默认调用object的hashcode的话，会调用native方法，与本地相关。</code></pre><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">native</span> <span class="keyword">int</span> <span class="title">hashCode</span><span class="params">()</span></span>;</span><br></pre></td></tr></table></figure>
 <a id="more"></a>    

<p>来自 ： <a href="https://zhuanlan.zhihu.com/p/33915892">https://zhuanlan.zhihu.com/p/33915892</a><br>下载完整的jdk呗<a href="https://github.com/dmlloyd/openjdk/tree/jdk8u/jdk8u">（</a><a href="https://github.com/dmlloyd/openjdk/tree/jdk8u/jdk8u">openJDK1.8</a><a href="https://github.com/dmlloyd/openjdk/tree/jdk8u/jdk8u">）</a>。找到<a href="https://github.com/dmlloyd/openjdk/blob/jdk8u/jdk8u/jdk/src/share/native/java/lang/Object.c">Object.c</a>文件，查看上面的方法映射表发现，hashCode被映射到了一个叫JVM_IHashCode上去了。</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">static</span> JNINativeMethod methods[] = &#123;</span><br><span class="line">    &#123;<span class="string">"hashCode"</span>,    <span class="string">"()I"</span>,                    (<span class="keyword">void</span> *)&amp;JVM_IHashCode&#125;,</span><br><span class="line">    &#123;<span class="string">"wait"</span>,        <span class="string">"(J)V"</span>,                   (<span class="keyword">void</span> *)&amp;JVM_MonitorWait&#125;,</span><br><span class="line">    &#123;<span class="string">"notify"</span>,      <span class="string">"()V"</span>,                    (<span class="keyword">void</span> *)&amp;JVM_MonitorNotify&#125;,</span><br><span class="line">    &#123;<span class="string">"notifyAll"</span>,   <span class="string">"()V"</span>,                    (<span class="keyword">void</span> *)&amp;JVM_MonitorNotifyAll&#125;,</span><br><span class="line">    &#123;<span class="string">"clone"</span>,       <span class="string">"()Ljava/lang/Object;"</span>,   (<span class="keyword">void</span> *)&amp;JVM_Clone&#125;,</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<p>顺藤摸瓜去看看JVM_IHashCode到底干了什么？熟悉的味道，在jvm.h里面有方法声明，那实现一定在jvm.cpp里面。不过<a href="https://link.zhihu.com/?target=https%3A//github.com/dmlloyd/openjdk/blob/jdk8u/jdk8u/hotspot/src/share/vm/prims/jvm.cpp">jvm.cpp</a>对于JVM_IHashCode的实现调用的是ObjectSynchronizer::<strong>FastHashCode</strong>的方法。</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">JVM_ENTRY(jint, JVM_IHashCode(JNIEnv* env, jobject handle))</span><br><span class="line">  JVMWrapper(<span class="string">"JVM_IHashCode"</span>);</span><br><span class="line">  <span class="comment">// as implemented in the classic virtual machine; return 0 if object is NULL</span></span><br><span class="line">  <span class="keyword">return</span> handle == <span class="literal">NULL</span> ? <span class="number">0</span> : ObjectSynchronizer::FastHashCode (THREAD, JNIHandles::resolve_non_null(handle)) ;</span><br><span class="line">JVM_END</span><br></pre></td></tr></table></figure>

<p>发现声明在<a href="https://link.zhihu.com/?target=https%3A//github.com/dmlloyd/openjdk/blob/jdk/jdk/src/hotspot/share/runtime/synchronizer.hpp">synchronizer.hpp</a> 实现在这里<a href="https://link.zhihu.com/?target=https%3A//github.com/dmlloyd/openjdk/blob/jdk/jdk/src/hotspot/share/runtime/synchronizer.cpp">synchronizer.cpp</a></p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// hashCode() generation :</span></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="comment">// Possibilities:</span></span><br><span class="line"><span class="comment">// * MD5Digest of &#123;obj,stwRandom&#125;</span></span><br><span class="line"><span class="comment">// * CRC32 of &#123;obj,stwRandom&#125; or any linear-feedback shift register function.</span></span><br><span class="line"><span class="comment">// * A DES- or AES-style SBox[] mechanism</span></span><br><span class="line"><span class="comment">// * One of the Phi-based schemes, such as:</span></span><br><span class="line"><span class="comment">//   2654435761 = 2^32 * Phi (golden ratio)</span></span><br><span class="line"><span class="comment">//   HashCodeValue = ((uintptr_t(obj) &gt;&gt; 3) * 2654435761) ^ GVars.stwRandom ;</span></span><br><span class="line"><span class="comment">// * A variation of Marsaglia's shift-xor RNG scheme.</span></span><br><span class="line"><span class="comment">// * (obj ^ stwRandom) is appealing, but can result</span></span><br><span class="line"><span class="comment">//   in undesirable regularity in the hashCode values of adjacent objects</span></span><br><span class="line"><span class="comment">//   (objects allocated back-to-back, in particular).  This could potentially</span></span><br><span class="line"><span class="comment">//   result in hashtable collisions and reduced hashtable efficiency.</span></span><br><span class="line"><span class="comment">//   There are simple ways to "diffuse" the middle address bits over the</span></span><br><span class="line"><span class="comment">//   generated hashCode values:</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">static</span> <span class="keyword">inline</span> <span class="keyword">intptr_t</span> <span class="title">get_next_hash</span><span class="params">(Thread * Self, oop obj)</span> </span>&#123;</span><br><span class="line">  <span class="keyword">intptr_t</span> value = <span class="number">0</span>;</span><br><span class="line">  <span class="keyword">if</span> (hashCode == <span class="number">0</span>) &#123;</span><br><span class="line">    <span class="comment">// This form uses global Park-Miller RNG.</span></span><br><span class="line">    <span class="comment">// On MP system we'll have lots of RW access to a global, so the</span></span><br><span class="line">    <span class="comment">// mechanism induces lots of coherency traffic.</span></span><br><span class="line">    value = os::<span class="built_in">random</span>();</span><br><span class="line">  &#125; <span class="keyword">else</span> <span class="keyword">if</span> (hashCode == <span class="number">1</span>) &#123;</span><br><span class="line">    <span class="comment">// This variation has the property of being stable (idempotent)</span></span><br><span class="line">    <span class="comment">// between STW operations.  This can be useful in some of the 1-0</span></span><br><span class="line">    <span class="comment">// synchronization schemes.</span></span><br><span class="line">    <span class="keyword">intptr_t</span> addrBits = cast_from_oop&lt;<span class="keyword">intptr_t</span>&gt;(obj) &gt;&gt; <span class="number">3</span>;</span><br><span class="line">    value = addrBits ^ (addrBits &gt;&gt; <span class="number">5</span>) ^ GVars.stwRandom;</span><br><span class="line">  &#125; <span class="keyword">else</span> <span class="keyword">if</span> (hashCode == <span class="number">2</span>) &#123;</span><br><span class="line">    value = <span class="number">1</span>;            <span class="comment">// for sensitivity testing</span></span><br><span class="line">  &#125; <span class="keyword">else</span> <span class="keyword">if</span> (hashCode == <span class="number">3</span>) &#123;</span><br><span class="line">    value = ++GVars.hcSequence;</span><br><span class="line">  &#125; <span class="keyword">else</span> <span class="keyword">if</span> (hashCode == <span class="number">4</span>) &#123;</span><br><span class="line">    value = cast_from_oop&lt;<span class="keyword">intptr_t</span>&gt;(obj);</span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="comment">// Marsaglia's xor-shift scheme with thread-specific state</span></span><br><span class="line">    <span class="comment">// This is probably the best overall implementation -- we'll</span></span><br><span class="line">    <span class="comment">// likely make this the default in future releases.</span></span><br><span class="line">    <span class="keyword">unsigned</span> t = Self-&gt;_hashStateX;</span><br><span class="line">    t ^= (t &lt;&lt; <span class="number">11</span>);</span><br><span class="line">    Self-&gt;_hashStateX = Self-&gt;_hashStateY;</span><br><span class="line">    Self-&gt;_hashStateY = Self-&gt;_hashStateZ;</span><br><span class="line">    Self-&gt;_hashStateZ = Self-&gt;_hashStateW;</span><br><span class="line">    <span class="keyword">unsigned</span> v = Self-&gt;_hashStateW;</span><br><span class="line">    v = (v ^ (v &gt;&gt; <span class="number">19</span>)) ^ (t ^ (t &gt;&gt; <span class="number">8</span>));</span><br><span class="line">    Self-&gt;_hashStateW = v;</span><br><span class="line">    value = v;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  value &amp;= markOopDesc::hash_mask;</span><br><span class="line">  <span class="keyword">if</span> (value == <span class="number">0</span>) value = <span class="number">0xBAD</span>;</span><br><span class="line">  assert(value != markOopDesc::no_hash, <span class="string">"invariant"</span>);</span><br><span class="line">  TEVENT(hashCode: GENERATE);</span><br><span class="line">  <span class="keyword">return</span> value;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">intptr_t</span> <span class="title">ObjectSynchronizer::FastHashCode</span><span class="params">(Thread * Self, oop obj)</span> </span>&#123;</span><br><span class="line">  <span class="keyword">if</span> (UseBiasedLocking) &#123;</span><br><span class="line">    <span class="comment">// <span class="doctag">NOTE:</span> many places throughout the JVM do not expect a safepoint</span></span><br><span class="line">    <span class="comment">// to be taken here, in particular most operations on perm gen</span></span><br><span class="line">    <span class="comment">// objects. However, we only ever bias Java instances and all of</span></span><br><span class="line">    <span class="comment">// the call sites of identity_hash that might revoke biases have</span></span><br><span class="line">    <span class="comment">// been checked to make sure they can handle a safepoint. The</span></span><br><span class="line">    <span class="comment">// added check of the bias pattern is to avoid useless calls to</span></span><br><span class="line">    <span class="comment">// thread-local storage.</span></span><br><span class="line">    <span class="keyword">if</span> (obj-&gt;mark()-&gt;has_bias_pattern()) &#123;</span><br><span class="line">      <span class="comment">// Handle for oop obj in case of STW safepoint</span></span><br><span class="line">      <span class="function">Handle <span class="title">hobj</span><span class="params">(Self, obj)</span></span>;</span><br><span class="line">      <span class="comment">// Relaxing assertion for bug 6320749.</span></span><br><span class="line">      assert(Universe::verify_in_progress() ||</span><br><span class="line">             !SafepointSynchronize::is_at_safepoint(),</span><br><span class="line">             <span class="string">"biases should not be seen by VM thread here"</span>);</span><br><span class="line">      BiasedLocking::revoke_and_rebias(hobj, <span class="literal">false</span>, JavaThread::current());</span><br><span class="line">      obj = hobj();</span><br><span class="line">      assert(!obj-&gt;mark()-&gt;has_bias_pattern(), <span class="string">"biases should be revoked by now"</span>);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// hashCode() is a heap mutator ...</span></span><br><span class="line">  <span class="comment">// Relaxing assertion for bug 6320749.</span></span><br><span class="line">  assert(Universe::verify_in_progress() || DumpSharedSpaces ||</span><br><span class="line">         !SafepointSynchronize::is_at_safepoint(), <span class="string">"invariant"</span>);</span><br><span class="line">  assert(Universe::verify_in_progress() || DumpSharedSpaces ||</span><br><span class="line">         Self-&gt;is_Java_thread() , <span class="string">"invariant"</span>);</span><br><span class="line">  assert(Universe::verify_in_progress() || DumpSharedSpaces ||</span><br><span class="line">         ((JavaThread *)Self)-&gt;thread_state() != _thread_blocked, <span class="string">"invariant"</span>);</span><br><span class="line"></span><br><span class="line">  ObjectMonitor* monitor = <span class="literal">NULL</span>;</span><br><span class="line">  markOop temp, test;</span><br><span class="line">  <span class="keyword">intptr_t</span> hash;</span><br><span class="line">  markOop mark = ReadStableMark(obj);</span><br><span class="line"></span><br><span class="line">  <span class="comment">// object should remain ineligible for biased locking</span></span><br><span class="line">  assert(!mark-&gt;has_bias_pattern(), <span class="string">"invariant"</span>);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">if</span> (mark-&gt;is_neutral()) &#123;</span><br><span class="line">    hash = mark-&gt;hash();              <span class="comment">// this is a normal header</span></span><br><span class="line">    <span class="keyword">if</span> (hash) &#123;                       <span class="comment">// if it has hash, just return it</span></span><br><span class="line">      <span class="keyword">return</span> hash;</span><br><span class="line">    &#125;</span><br><span class="line">    hash = get_next_hash(Self, obj);  <span class="comment">// allocate a new hash code</span></span><br><span class="line">    temp = mark-&gt;copy_set_hash(hash); <span class="comment">// merge the hash code into header</span></span><br><span class="line">    <span class="comment">// use (machine word version) atomic operation to install the hash</span></span><br><span class="line">    test = obj-&gt;cas_set_mark(temp, mark);</span><br><span class="line">    <span class="keyword">if</span> (test == mark) &#123;</span><br><span class="line">      <span class="keyword">return</span> hash;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// If atomic operation failed, we must inflate the header</span></span><br><span class="line">    <span class="comment">// into heavy weight monitor. We could add more code here</span></span><br><span class="line">    <span class="comment">// for fast path, but it does not worth the complexity.</span></span><br><span class="line">  &#125; <span class="keyword">else</span> <span class="keyword">if</span> (mark-&gt;has_monitor()) &#123;</span><br><span class="line">    monitor = mark-&gt;monitor();</span><br><span class="line">    temp = monitor-&gt;header();</span><br><span class="line">    assert(temp-&gt;is_neutral(), <span class="string">"invariant"</span>);</span><br><span class="line">    hash = temp-&gt;hash();</span><br><span class="line">    <span class="keyword">if</span> (hash) &#123;</span><br><span class="line">      <span class="keyword">return</span> hash;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// Skip to the following code to reduce code size</span></span><br><span class="line">  &#125; <span class="keyword">else</span> <span class="keyword">if</span> (Self-&gt;is_lock_owned((address)mark-&gt;locker())) &#123;</span><br><span class="line">    temp = mark-&gt;displaced_mark_helper(); <span class="comment">// this is a lightweight monitor owned</span></span><br><span class="line">    assert(temp-&gt;is_neutral(), <span class="string">"invariant"</span>);</span><br><span class="line">    hash = temp-&gt;hash();              <span class="comment">// by current thread, check if the displaced</span></span><br><span class="line">    <span class="keyword">if</span> (hash) &#123;                       <span class="comment">// header contains hash code</span></span><br><span class="line">      <span class="keyword">return</span> hash;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// WARNING:</span></span><br><span class="line">    <span class="comment">//   The displaced header is strictly immutable.</span></span><br><span class="line">    <span class="comment">// It can NOT be changed in ANY cases. So we have</span></span><br><span class="line">    <span class="comment">// to inflate the header into heavyweight monitor</span></span><br><span class="line">    <span class="comment">// even the current thread owns the lock. The reason</span></span><br><span class="line">    <span class="comment">// is the BasicLock (stack slot) will be asynchronously</span></span><br><span class="line">    <span class="comment">// read by other threads during the inflate() function.</span></span><br><span class="line">    <span class="comment">// Any change to stack may not propagate to other threads</span></span><br><span class="line">    <span class="comment">// correctly.</span></span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// Inflate the monitor to set hash code</span></span><br><span class="line">  monitor = ObjectSynchronizer::inflate(Self, obj, inflate_cause_hash_code);</span><br><span class="line">  <span class="comment">// Load displaced header and check it has hash code</span></span><br><span class="line">  mark = monitor-&gt;header();</span><br><span class="line">  assert(mark-&gt;is_neutral(), <span class="string">"invariant"</span>);</span><br><span class="line">  hash = mark-&gt;hash();</span><br><span class="line">  <span class="keyword">if</span> (hash == <span class="number">0</span>) &#123;</span><br><span class="line">    hash = get_next_hash(Self, obj);</span><br><span class="line">    temp = mark-&gt;copy_set_hash(hash); <span class="comment">// merge hash code into header</span></span><br><span class="line">    assert(temp-&gt;is_neutral(), <span class="string">"invariant"</span>);</span><br><span class="line">    test = Atomic::cmpxchg(temp, monitor-&gt;header_addr(), mark);</span><br><span class="line">    <span class="keyword">if</span> (test != mark) &#123;</span><br><span class="line">      <span class="comment">// The only update to the header in the monitor (outside GC)</span></span><br><span class="line">      <span class="comment">// is install the hash code. If someone add new usage of</span></span><br><span class="line">      <span class="comment">// displaced header, please update this code</span></span><br><span class="line">      hash = test-&gt;hash();</span><br><span class="line">      assert(test-&gt;is_neutral(), <span class="string">"invariant"</span>);</span><br><span class="line">      assert(hash != <span class="number">0</span>, <span class="string">"Trivial unexpected object/monitor header usage."</span>);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">// We finally get the hash</span></span><br><span class="line">  <span class="keyword">return</span> hash;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="2-Java-Object-hashCode-返回的是对象内存地址？不是！"><a href="#2-Java-Object-hashCode-返回的是对象内存地址？不是！" class="headerlink" title="2.Java Object.hashCode()返回的是对象内存地址？不是！"></a>2.Java Object.hashCode()返回的是对象内存地址？不是！</h4><p>OpenJDK8 默认hashCode的计算方法是通过和当前线程有关的一个随机数+三个确定值，运用Marsaglia’s xorshift scheme随机数算法得到的一个随机数。<strong>和对象内存地址无关</strong>。<br>当然也可以自己实现hashcode方法，关于hashcode() 与 equals()。主要是利用hashcode 可以判断2个对象的<strong>不等</strong>，hashcode相等，对象不一定相等，但hashcode不等，可以肯定2个对象不相等。在很多地方判断对象等不等。如果equals 定义了2个对象是相等的，需要注意hashcode还是不是相等的。</p>
<h4 id="3-String类的hasCode"><a href="#3-String类的hasCode" class="headerlink" title="3.String类的hasCode()"></a>3.String类的hasCode()</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">hashCode</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">int</span> h = hash;</span><br><span class="line">        <span class="keyword">if</span> (h == <span class="number">0</span> &amp;&amp; value.length &gt; <span class="number">0</span>) &#123;</span><br><span class="line">            <span class="keyword">char</span> val[] = value;</span><br><span class="line"></span><br><span class="line">            <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; value.length; i++) &#123;</span><br><span class="line">                h = <span class="number">31</span> * h + val[i];</span><br><span class="line">            &#125;</span><br><span class="line">            hash = h;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> h;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>

<h3 id="2-使用JOL查看对象信息"><a href="#2-使用JOL查看对象信息" class="headerlink" title="2.使用JOL查看对象信息"></a>2.使用JOL查看对象信息</h3><p>maven 依赖</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&lt;dependency&gt;</span><br><span class="line">                &lt;groupId&gt;org.openjdk.jol&lt;/groupId&gt;</span><br><span class="line">                &lt;artifactId&gt;jol-core&lt;/artifactId&gt;</span><br><span class="line">                &lt;version&gt;0.9&lt;/version&gt;</span><br><span class="line">&lt;/dependency&gt;</span><br></pre></td></tr></table></figure>
<p>为了内存比较“整齐”，关闭压缩指针，启动参数加上-XX:-UseCompressedOops</p>
<h4 id="1-测试对象"><a href="#1-测试对象" class="headerlink" title="1.测试对象"></a>1.测试对象</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">AAA</span></span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">int</span> number;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="2-测试方式1"><a href="#2-测试方式1" class="headerlink" title="2.测试方式1"></a>2.测试方式1</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        AAA aaa = <span class="keyword">new</span> AAA();</span><br><span class="line">        System.out.println(<span class="string">"---------before invoke hascode()-----------------"</span>);</span><br><span class="line">        System.out.println(ClassLayout.parseInstance(aaa).toPrintable());</span><br><span class="line"></span><br><span class="line">        <span class="comment">/*invoke hashcode() 转换成16进制*/</span></span><br><span class="line">        System.out.println(Integer.toHexString(aaa.hashCode()));</span><br><span class="line">        System.out.println(<span class="string">"------------after invoke hascode()-----------------"</span>);</span><br><span class="line">        System.out.println(ClassLayout.parseInstance(aaa).toPrintable());</span><br><span class="line"></span><br><span class="line">        <span class="keyword">synchronized</span> (aaa)&#123;</span><br><span class="line">            System.out.println(<span class="string">"---------in synchronized() func--------------"</span>);</span><br><span class="line">            System.out.println(Integer.toHexString(aaa.hashCode()));</span><br><span class="line">            System.out.println(ClassLayout.parseInstance(aaa).toPrintable());</span><br><span class="line">            System.out.println(Integer.toHexString(aaa.hashCode()));</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        System.out.println(<span class="string">"---------after invoke  synchronized()--------------"</span>);</span><br><span class="line">        System.out.println(Integer.toHexString(aaa.hashCode()));</span><br><span class="line">        System.out.println(ClassLayout.parseInstance(aaa).toPrintable());</span><br><span class="line"></span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>
<p>输出</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></td><td class="code"><pre><span class="line">---------before invoke hascode()-----------------</span><br><span class="line">AAA object internals:</span><br><span class="line"> OFFSET  SIZE   TYPE DESCRIPTION                               VALUE</span><br><span class="line">      0     4        (object header)                           01 00 00 00 (00000001 00000000 00000000 00000000) (1)</span><br><span class="line">      4     4        (object header)                           00 00 00 00 (00000000 00000000 00000000 00000000) (0)</span><br><span class="line">      8     4        (object header)                           a8 35 85 1c (10101000 00110101 10000101 00011100) (478492072)</span><br><span class="line">     12     4        (object header)                           00 00 00 00 (00000000 00000000 00000000 00000000) (0)</span><br><span class="line">     16     4    int AAA.number                                0</span><br><span class="line">     20     4        (loss due to the next object alignment)</span><br><span class="line">Instance size: 24 bytes</span><br><span class="line">Space losses: 0 bytes internal + 4 bytes external = 4 bytes total</span><br><span class="line"></span><br><span class="line">7e0b37bc</span><br><span class="line">------------after invoke hascode()-----------------</span><br><span class="line">AAA object internals:</span><br><span class="line"> OFFSET  SIZE   TYPE DESCRIPTION                               VALUE</span><br><span class="line">      0     4        (object header)                           01 bc 37 0b (00000001 10111100 00110111 00001011) (188201985)</span><br><span class="line">      4     4        (object header)                           7e 00 00 00 (01111110 00000000 00000000 00000000) (126)</span><br><span class="line">      8     4        (object header)                           a8 35 85 1c (10101000 00110101 10000101 00011100) (478492072)</span><br><span class="line">     12     4        (object header)                           00 00 00 00 (00000000 00000000 00000000 00000000) (0)</span><br><span class="line">     16     4    int AAA.number                                0</span><br><span class="line">     20     4        (loss due to the next object alignment)</span><br><span class="line">Instance size: 24 bytes</span><br><span class="line">Space losses: 0 bytes internal + 4 bytes external = 4 bytes total</span><br><span class="line"></span><br><span class="line">---------<span class="keyword">in</span> synchronized() func--------------</span><br><span class="line">7e0b37bc</span><br><span class="line">AAA object internals:</span><br><span class="line"> OFFSET  SIZE   TYPE DESCRIPTION                               VALUE</span><br><span class="line">      0     4        (object header)                           b0 f4 34 03 (10110000 11110100 00110100 00000011) (53802160)</span><br><span class="line">      4     4        (object header)                           00 00 00 00 (00000000 00000000 00000000 00000000) (0)</span><br><span class="line">      8     4        (object header)                           a8 35 85 1c (10101000 00110101 10000101 00011100) (478492072)</span><br><span class="line">     12     4        (object header)                           00 00 00 00 (00000000 00000000 00000000 00000000) (0)</span><br><span class="line">     16     4    int AAA.number                                0</span><br><span class="line">     20     4        (loss due to the next object alignment)</span><br><span class="line">Instance size: 24 bytes</span><br><span class="line">Space losses: 0 bytes internal + 4 bytes external = 4 bytes total</span><br><span class="line"></span><br><span class="line">7e0b37bc</span><br><span class="line">---------after invoke  synchronized()--------------</span><br><span class="line">7e0b37bc</span><br><span class="line">AAA object internals:</span><br><span class="line"> OFFSET  SIZE   TYPE DESCRIPTION                               VALUE</span><br><span class="line">      0     4        (object header)                           01 bc 37 0b (00000001 10111100 00110111 00001011) (188201985)</span><br><span class="line">      4     4        (object header)                           7e 00 00 00 (01111110 00000000 00000000 00000000) (126)</span><br><span class="line">      8     4        (object header)                           a8 35 85 1c (10101000 00110101 10000101 00011100) (478492072)</span><br><span class="line">     12     4        (object header)                           00 00 00 00 (00000000 00000000 00000000 00000000) (0)</span><br><span class="line">     16     4    int AAA.number                                0</span><br><span class="line">     20     4        (loss due to the next object alignment)</span><br><span class="line">Instance size: 24 bytes</span><br><span class="line">Space losses: 0 bytes internal + 4 bytes external = 4 bytes total</span><br></pre></td></tr></table></figure>

<p>可以看到，在调用一次 hashcode之后，就会在object header 中生成hashcode。注意区分大小端模式。<br><img src="https://cdn.nlark.com/yuque/0/2019/png/501385/1570776081370-43ef6268-0f1d-4c3a-9b7d-9894dd3cee61.png#align=left&display=inline&height=377&name=%E6%90%9C%E7%8B%97%E6%88%AA%E5%9B%BE20191011144038.png&originHeight=377&originWidth=1541&size=57057&status=done&width=1541" alt="搜狗截图20191011144038.png"></p>
<p>object header 在有锁的情况下会发生变化，但是不会改变hashcode的值。</p>
<h4 id="为什么有锁的状态下，头部的hashcode会变。无锁后-又变回来了？"><a href="#为什么有锁的状态下，头部的hashcode会变。无锁后-又变回来了？" class="headerlink" title="为什么有锁的状态下，头部的hashcode会变。无锁后 又变回来了？"></a>为什么有锁的状态下，头部的hashcode会变。无锁后 又变回来了？</h4><p>这是因为header会随着锁的状态发生变化。只有在无锁的情况下，才是这些字段。<br><strong>unused:25 | identity_hashcode:31 | unused:1 | age:4 | biased_lock:1 | lock:2</strong></p>
<p>另外，调用了一次hashcode 就会在栈帧中存在hashcode，但是与 偏向锁的字段发生冲突，因此jvm采用调用过hashcode的，不会存在偏向锁。为什么其它锁 可以呢？因为保存了指向栈中锁记录的指针，可以记录在里面。<br><img src="https://cdn.nlark.com/yuque/0/2019/png/501385/1570782297262-ee25ccc2-9ee7-402b-9691-599d1aaf4b81.png#align=left&display=inline&height=302&name=%E6%90%9C%E7%8B%97%E6%88%AA%E5%9B%BE20191011162436.png&originHeight=302&originWidth=886&size=17459&status=done&width=886" alt="搜狗截图20191011162436.png"> </p>
</div><div class="article-tags size-small is-uppercase mb-4"><span class="mr-2">#</span><a class="link-muted mr-2" rel="tag" href="/tags/Java/">Java</a></div><!--!--></article></div><!--!--><nav class="post-navigation mt-4 level is-mobile"><div class="level-start"><a class="article-nav-prev level level-item link-muted" href="/2020/04/23/LeetCode/gu-piao-de-zui-da-li-run-lcof/"><i class="level-item fas fa-chevron-left"></i><span class="level-item">股票的最大利润</span></a></div><div class="level-end"><a class="article-nav-next level level-item link-muted" href="/2020/04/21/LeetCode/li-wu-de-zui-da-jie-zhi-lcof/"><span class="level-item">礼物的最大价值</span><i class="level-item fas fa-chevron-right"></i></a></div></nav><!--!--></div><div class="column column-left is-4-tablet is-4-desktop is-2-widescreen  order-1"><div class="card widget"><div class="card-content"><nav class="level"><div class="level-item has-text-centered flex-shrink-1"><div><figure class="image is-128x128 mx-auto mb-2"><img class="is-rounded" src="/img/myavatar.png" alt="Ken"></figure><p class="title is-size-4 is-block line-height-inherit">Ken</p><p class="is-size-6 is-block">爱于心，鉴于行</p></div></div></nav><nav class="level is-mobile"><div class="level-item has-text-centered is-marginless"><div><p class="heading">文章</p><a href="/archives"><p class="title">70</p></a></div></div><div class="level-item has-text-centered is-marginless"><div><p class="heading">分类</p><a href="/categories"><p class="title">13</p></a></div></div><div class="level-item has-text-centered is-marginless"><div><p class="heading">标签</p><a href="/tags"><p class="title">16</p></a></div></div></nav></div></div><div class="card widget"><div class="card-content"><div class="menu"><h3 class="menu-label">分类</h3><ul class="menu-list"><li><a class="level is-mobile is-marginless" href="/categories/Android/"><span class="level-start"><span class="level-item">Android</span></span><span class="level-end"><span class="level-item tag">18</span></span></a><ul class="mr-0"><li><a class="level is-mobile is-marginless" href="/categories/Android/Java/"><span class="level-start"><span class="level-item">Java</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile is-marginless" href="/categories/Android/Kotlin/"><span class="level-start"><span class="level-item">Kotlin</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li></ul></li><li><a class="level is-mobile is-marginless" href="/categories/LeetCode/"><span class="level-start"><span class="level-item">LeetCode</span></span><span class="level-end"><span class="level-item tag">17</span></span></a></li><li><a class="level is-mobile is-marginless" href="/categories/%E5%88%86%E4%BA%AB/"><span class="level-start"><span class="level-item">分享</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile is-marginless" href="/categories/%E6%A1%86%E6%9E%B6/"><span class="level-start"><span class="level-item">框架</span></span><span class="level-end"><span class="level-item tag">2</span></span></a></li><li><a class="level is-mobile is-marginless" href="/categories/%E8%AE%A1%E7%AE%97%E6%9C%BA%E5%9F%BA%E7%A1%80/"><span class="level-start"><span class="level-item">计算机基础</span></span><span class="level-end"><span class="level-item tag">3</span></span></a></li><li><a class="level is-mobile is-marginless" href="/categories/%E8%AF%AD%E8%A8%80%E5%9F%BA%E7%A1%80/"><span class="level-start"><span class="level-item">语言基础</span></span><span class="level-end"><span class="level-item tag">26</span></span></a><ul class="mr-0"><li><a class="level is-mobile is-marginless" href="/categories/%E8%AF%AD%E8%A8%80%E5%9F%BA%E7%A1%80/C/"><span class="level-start"><span class="level-item">C++</span></span><span class="level-end"><span class="level-item tag">2</span></span></a></li><li><a class="level is-mobile is-marginless" href="/categories/%E8%AF%AD%E8%A8%80%E5%9F%BA%E7%A1%80/Java/"><span class="level-start"><span class="level-item">Java</span></span><span class="level-end"><span class="level-item tag">21</span></span></a></li><li><a class="level is-mobile is-marginless" href="/categories/%E8%AF%AD%E8%A8%80%E5%9F%BA%E7%A1%80/Kotlin/"><span class="level-start"><span class="level-item">Kotlin</span></span><span class="level-end"><span class="level-item tag">3</span></span></a></li></ul></li><li><a class="level is-mobile is-marginless" href="/categories/%E9%97%AE%E9%A2%98%E4%B8%8E%E7%BB%8F%E9%AA%8C/"><span class="level-start"><span class="level-item">问题与经验</span></span><span class="level-end"><span class="level-item tag">2</span></span></a></li><li><a class="level is-mobile is-marginless" href="/categories/%E9%A1%B9%E7%9B%AE%E6%9E%B6%E6%9E%84/"><span class="level-start"><span class="level-item">项目架构</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li></ul></div></div></div><div class="card widget"><div class="card-content"><h3 class="menu-label">最新文章</h3><article class="media"><div class="media-content size-small"><p><time dateTime="2023-12-02T10:19:06.000Z">2023-12-02</time></p><p class="title is-6"><a class="link-muted" href="/2023/12/02/Android/android_import_rust/">Android项目接入Rust</a></p><p class="is-uppercase"><a class="link-muted" href="/categories/Android/">Android</a></p></div></article><article class="media"><div class="media-content size-small"><p><time dateTime="2023-11-07T09:30:35.000Z">2023-11-07</time></p><p class="title is-6"><a class="link-muted" href="/2023/11/07/Android/kotlin_name_dup/">Kotlin的变量重名问题</a></p><p class="is-uppercase"><a class="link-muted" href="/categories/%E8%AF%AD%E8%A8%80%E5%9F%BA%E7%A1%80/">语言基础</a> / <a class="link-muted" href="/categories/%E8%AF%AD%E8%A8%80%E5%9F%BA%E7%A1%80/Kotlin/">Kotlin</a></p></div></article><article class="media"><div class="media-content size-small"><p><time dateTime="2023-10-14T10:09:12.000Z">2023-10-14</time></p><p class="title is-6"><a class="link-muted" href="/2023/10/14/Android/kotlin_android_init_no_method/">小心Kotlin下的构造函数NoSuchMethodException</a></p><p class="is-uppercase"><a class="link-muted" href="/categories/Android/">Android</a> / <a class="link-muted" href="/categories/Android/Kotlin/">Kotlin</a></p></div></article><article class="media"><div class="media-content size-small"><p><time dateTime="2023-08-12T07:45:13.000Z">2023-08-12</time></p><p class="title is-6"><a class="link-muted" href="/2023/08/12/Android/compose_inspector/">解决 Compose Layout Inspector 不能用</a></p><p class="is-uppercase"><a class="link-muted" href="/categories/Android/">Android</a></p></div></article><article class="media"><div class="media-content size-small"><p><time dateTime="2023-05-14T12:39:42.000Z">2023-05-14</time></p><p class="title is-6"><a class="link-muted" href="/2023/05/14/%E9%97%AE%E9%A2%98%E4%B8%8E%E7%BB%8F%E9%AA%8C/typetojson/">泛型的反序列化</a></p><p class="is-uppercase"><a class="link-muted" href="/categories/%E9%97%AE%E9%A2%98%E4%B8%8E%E7%BB%8F%E9%AA%8C/">问题与经验</a></p></div></article></div></div><div class="card widget"><div class="card-content"><div class="menu"><h3 class="menu-label">标签</h3><div class="field is-grouped is-grouped-multiline"><div class="control"><a class="tags has-addons" href="/tags/Android/"><span class="tag">Android</span><span class="tag is-grey-lightest">14</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Bug/"><span class="tag">Bug</span><span class="tag is-grey-lightest">10</span></a></div><div class="control"><a class="tags has-addons" href="/tags/C/"><span class="tag">C++</span><span class="tag is-grey-lightest">2</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Compose/"><span class="tag">Compose</span><span class="tag is-grey-lightest">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Gradle/"><span class="tag">Gradle</span><span class="tag is-grey-lightest">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/JNI/"><span class="tag">JNI</span><span class="tag is-grey-lightest">2</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Java/"><span class="tag">Java</span><span class="tag is-grey-lightest">23</span></a></div><div class="control"><a class="tags has-addons" href="/tags/K8S/"><span class="tag">K8S</span><span class="tag is-grey-lightest">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Kotlin/"><span class="tag">Kotlin</span><span class="tag is-grey-lightest">4</span></a></div><div class="control"><a class="tags has-addons" href="/tags/LeetCode/"><span class="tag">LeetCode</span><span class="tag is-grey-lightest">17</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Rust/"><span class="tag">Rust</span><span class="tag is-grey-lightest">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Spark/"><span class="tag">Spark</span><span class="tag is-grey-lightest">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/%E5%88%86%E4%BA%AB/"><span class="tag">分享</span><span class="tag is-grey-lightest">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/%E5%AE%89%E8%A3%85/"><span class="tag">安装</span><span class="tag is-grey-lightest">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F/"><span class="tag">操作系统</span><span class="tag is-grey-lightest">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/%E8%AE%A1%E7%BB%84/"><span class="tag">计组</span><span class="tag is-grey-lightest">1</span></a></div></div></div></div></div><div class="column-right-shadow is-hidden-widescreen is-sticky"></div></div><div class="column column-right is-4-tablet is-4-desktop is-2-widescreen is-hidden-touch is-hidden-desktop-only order-3 is-sticky"><div class="card widget toc-scroll" id="toc"><div class="card-content"><div class="menu" style="max-height: 600px; overflow: auto;"><h3 class="menu-label">目录</h3><ul class="menu-list toc"><li><a class="is-flex toc-item" id="toc-item-1-hashcode" href="#1-hashcode"><span>1. hashcode</span></a></li><li><a class="is-flex toc-item" id="toc-item-2-使用JOL查看对象信息" href="#2-使用JOL查看对象信息"><span>2.使用JOL查看对象信息</span></a></li></ul></div></div><script type="text/javascript" async>
        $(document).ready(function () { //参考自 https://github.com/ppoffice/hexo-theme-icarus/pull/616/files
            var observerTopMargin;
            var scrollObserver;
            var headerElems = $(".headerlink");
            var activeTocItem;
        
            function initIntersectionObserver(docHeight) {
                observerTopMargin = docHeight;
                scrollObserver = new IntersectionObserver(scrollCallBack,
                    {
                        root: null,  // viewpoint
                        rootMargin: docHeight + "px 0px -80% 0px"  // cover top 30% of viewport to the top of document
                    })
            }
        
            function scrollCallBack(entries, observer) {
                if ($(window).scrollTop() > observerTopMargin * 0.7) { 
                    // User somehow scroll to 70% of observerTopMargin (which is inited as 200% document height)
                    // Observer top margin need to extend to cover all the space to the top of the document
                    initIntersectionObserver(observerTopMargin * 2)
                    observer.disconnect();
                    return;
                }
                let toActive;
                if (entries[0].intersectionRatio == 1) {  // enter viewed area
                    let entry = entries.reduce((u, v) => (u.target.toc_id > v.target.toc_id ? u : v));  // get the lowest item
                    toActive = $("#toc-item-" + $(entry.target).attr("href").substr(1));
                } else {
                    let entry = entries.reduce((u, v) => (u.target.toc_id < v.target.toc_id ? u : v));  // get the highest item
                    let idx = Math.max(entry.target.toc_id - 1, 0);
                    toActive = $("#toc-item-" + $(headerElems[idx]).attr("href").substr(1));
                }
                if (activeTocItem) activeTocItem.removeClass("is-current");
                activeTocItem = toActive
                activeTocItem.addClass("is-current");
            }
        
            initIntersectionObserver($(document).height() * 2);
            headerElems.each(function (index, obj) {
                obj.toc_id = index;
                scrollObserver.observe(obj);
            })
        });</script></div></div></div></div></section><footer class="footer"><div class="container"><div class="level"><div class="level-start"><a class="footer-logo is-block mb-2" href="/"><img src="/img/logo.png" alt="Keeplooking" height="28"></a><p class="size-small"><span>&copy; 2019 - 2023  Ken Chan</span>  </p></div><div class="level-end"><div class="field has-addons"><p class="control"><a class="button is-transparent is-large" target="_blank" rel="noopener" title="Creative Commons" href="https://creativecommons.org/"><i class="fab fa-creative-commons"></i></a></p><p class="control"><a class="button is-transparent is-large" target="_blank" rel="noopener" title="Attribution 4.0 International" href="https://creativecommons.org/licenses/by/4.0/"><i class="fab fa-creative-commons-by"></i></a></p><p class="control"><a class="button is-transparent is-large" target="_blank" rel="noopener" title="Fllow GitHub" href="https://github.com/kaiattrib"><i class="fab fa-github"></i></a></p></div></div></div></div></footer><script src="https://cdnjs.loli.net/ajax/libs/jquery/3.3.1/jquery.min.js"></script><script src="https://cdnjs.loli.net/ajax/libs/moment.js/2.22.2/moment-with-locales.min.js"></script><script>moment.locale("zh-CN");</script><script>var IcarusThemeSettings = {
            site: {
                url: 'http://yoursite.com',
                external_link: {"enable":true,"exclude":[]}
            },
            article: {
                highlight: {
                    clipboard: true,
                    fold: 'unfolded'
                }
            }
        };</script><script src="https://cdnjs.loli.net/ajax/libs/clipboard.js/2.0.4/clipboard.min.js" defer></script><script src="/js/animation.js"></script><a id="back-to-top" title="回到顶端" href="javascript:;"><i class="fas fa-chevron-up"></i></a><script src="/js/back_to_top.js" defer></script><!--!--><script src="https://cdnjs.loli.net/ajax/libs/lightgallery/1.6.8/js/lightgallery.min.js" defer></script><script src="https://cdnjs.loli.net/ajax/libs/justifiedGallery/3.7.0/js/jquery.justifiedGallery.min.js" defer></script><script>window.addEventListener("load", () => {
            if (typeof $.fn.lightGallery === 'function') {
                $('.article').lightGallery({ selector: '.gallery-item' });
            }
            if (typeof $.fn.justifiedGallery === 'function') {
                if ($('.justified-gallery > p > .gallery-item').length) {
                    $('.justified-gallery > p > .gallery-item').unwrap();
                }
                $('.justified-gallery').justifiedGallery();
            }
        });</script><!--!--><!--!--><script src="/js/main.js" defer></script><div class="searchbox"><div class="searchbox-container"><div class="searchbox-header"><div class="searchbox-input-container"><input class="searchbox-input" type="text" placeholder="想要查找什么..."></div><a class="searchbox-close" href="javascript:;">×</a></div><div class="searchbox-body"></div></div></div><script src="/js/insight.js" defer></script><script>document.addEventListener('DOMContentLoaded', function () {
            loadInsight({"contentUrl":"/content.json"}, {"hint":"想要查找什么...","untitled":"(无标题)","posts":"文章","pages":"页面","categories":"分类","tags":"标签"});
        });</script></body></html>